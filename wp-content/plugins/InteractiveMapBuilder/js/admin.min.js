var map_options=null;var options;var default_options;(function(a){a.fn.fitText=function(){this.each(function(){var d=jQuery(this);if(typeof d.data("fitText")==="undefined"){d.data("fitText",d.text())}else{d.text(d.data("fitText"))}var b=0;if(d.text()==""){return}var c=d.parent().height();while(d.outerHeight()>c&&100>b++){d.text(function(e,f){return f.replace(/\W*\s(\S)*$/,"...")})}});return this};a(function(){a.event.special.tap={distanceThreshold:10,timeThreshold:500,setup:function(){var aH=this,aI=a(aH);aI.on("touchstart",function(aK){var aP=aK.target,aJ=aK.originalEvent.touches[0],aM=aJ.pageX,aL=aJ.pageY,aN=a.event.special.tap.distanceThreshold,aR;function aQ(){clearTimeout(aR);aI.off("touchmove",aO).off("touchend",aS)}function aS(aT){aQ();if(aP==aT.target){a.event.simulate("tap",aH,aT)}}function aO(aW){var aV=aW.originalEvent.touches[0],aU=aV.pageX,aT=aV.pageY;if(Math.abs(aU-aM)>aN||Math.abs(aT-aL)>aN){aQ()}}aR=setTimeout(aQ,a.event.special.tap.timeThreshold);aI.on("touchmove",aO).on("touchend",aS)})}};var aG=function(aK,aH,aI){var aL;return function aJ(){var aO=this,aN=arguments;function aM(){if(!aI){aK.apply(aO,aN)}aL=null}if(aL){clearTimeout(aL)}else{if(aI){aK.apply(aO,aN)}}aL=setTimeout(aM,aH||100)}};if(!("ontouchstart" in document.documentElement)){jQuery(".wrap").addClass("notouch")}var R=function(aH){jQuery(".more_indicator").not(aH).removeClass("touch")};jQuery(".wrap").on("touchstart",function(aH){R(jQuery(aH.target).parents(".more_indicator").add(aH.target))});jQuery(".more_indicator.option_select .value").click(function(aI){var aH=jQuery(aI.target).parents(".more_indicator");aH.css("width",aH.width());aH.find("ul li").removeClass("selected");aH.find(".show_selected_here").text(jQuery(this).text());jQuery(this).addClass("selected")});jQuery(".more_indicator.option_multiselect .value").click(function(aH){jQuery(this).toggleClass("selected")});var m=function(){jQuery(".more_indicator").off("touchstart").on("touchstart",function(aJ){var aI=jQuery(aJ.target);var aH=jQuery(this);if(aI.parents(".inner_body").length==0){aH.toggleClass("touch");aJ.preventDefault()}})};m();if(jQuery("#new_maps_page").length!=0){var P=jQuery("#data_table");var l=jQuery(".data_table_form");var I=jQuery(".data_table_form_arrow");var c=P.find("tbody");var C=P.find(".clone_row");var al=jQuery("[name=click_action_select]");var aE=jQuery("#click_action_description");var an=jQuery("#example_click_action_value");var Q=new Preview_Handler(iframe_url,iframe_name,".loader");var ak=new Regions(default_options.region);var k=new ResolutionMap(default_options.resolution,ak.find_resolutions(ak.get_value()));var v=new DisplayMode(current_mode);var p=new OptionMapper();jQuery.data(document.body,"loading_no",0);jQuery.data(document.body,"preview",Q);jQuery.data(document.body,"form",l);jQuery.data(document.body,"table",P);var av=[["#mapstyle_bgcolor","background_color","color",null],["#mapstyle_datalesscolor","dataless_regions_color","color",null],["#mapstyle_height","height","number","auto"],["#mapstyle_width","width","number","auto"],["#mapstyle_aspectratio","keep_aspect_ratio","bool",null],["#mapstyle_interactivity","enable_region_interactivity","bool",null],["#mapstyle_bordersize","border_width","number",null],["#mapstyle_bordercolor","border_color","color",null],["#mapstyle_markersize","marker_size","number",null],["#mapstyle_markeropacity","marker_opacity","percent",null],["#show_tooltips","tooltip_enable","bool",null],["#tooltip_background_color","tooltip_color","color",null],["#tooltip_font_name","tooltip_font_family","string","<global-font-name>"],["#tooltip_font_size","tooltip_font_size","number","<global-font-size>"]];var at=Q.get_iframe();var U=function(){aF();jQuery.ajax({dataType:"json",url:imb_object.ajax_url,proccessData:true,type:"POST",data:{action:"translate_table",table:N(),mode:current_mode},success:function(aH){default_options.colorAxis["colors"]=aH.colors;default_options.colorAxis["maxValue"]=aH.maxvalue;gtable=aH.table;click_actions=aH.actions;ag()},error:function(aH){},timeout:15000})};var aF=function(){var aH=jQuery.data(document.body,"loading_no");aH++;jQuery.data(document.body,"loading_no",aH);Q.show_loader();var aI=Q;setTimeout(function(){if(aH==jQuery.data(document.body,"loading_no")){aI.hide_loader()}},8000)};var ag=function(){var aH=at[0].contentWindow;if(typeof aH.drawMarkersMap=="function"){aF();aH.drawMarkersMap()}};var u=function(aH){var aI=jQuery(".add_to_table").eq(0);l.find("[name=location]").val(aH);aI.trigger("click")};var aD=function(aO,aH,aN,aK,aI,aL,aJ,aM){aO.find(".rm_column").text(aH);aO.find(".latitude").text(aN);aO.find(".longitude").text(aK);aO.find(".color_circle").css("backgroundColor",aI);aO.find(".tooltip_title_cell").text(aL);aO.find(".tooltip_text_cell").text(aJ);aO.find(".clickaction_column").text(aM);return aO};var j=function(aH,aN,aK,aI,aL,aJ,aM){return aD(C.clone().removeClass("clone_row"),aH,aN,aK,aI,aL,aJ,aM)};var B=function(aH,aN,aK,aI,aL,aJ,aM){l.find("[name=location]").val(aH);l.find("[name=latitude]").val(aN);l.find("[name=longitude]").val(aK);l.find("[name=form_color]").val(aI).css("backgroundColor",aI).css("color",q(L(aI)));l.find("[name=tooltip_title]").val(aL);l.find("[name=tooltip_text]").val(aJ);l.find("[name=click_action]").val(aM)};var af=function(aJ,aV){var aS=aJ.offset().top-aJ.offsetParent().offset().top;var aO=10+jQuery("#wpadminbar").height();var aM=10;var aK=5;var aL=22+aK;var aH=54+aK;var aN=aJ.position().top;var aI=aJ.offset().top-jQuery(document).scrollTop();var aT=aI+aK+aJ.height()+aK;var aR=aV.offset().top-jQuery(document).scrollTop();var aP=aR+aV.height();var aU=jQuery(window).height()-aM-aT;var aQ=(aU<0)?aU:0;aU=(aI+aQ)-aO;aQ-=(aU<0)?aU:0;aU=(aT+aQ)-aH-aP;aQ-=(aU<0)?aU:0;aU=aR-(aI+aQ+aL);aQ+=(aU<0)?aU:0;aS=aN+aQ;aJ.css("top",aS);return aS};var A=function(){var aH={};aH.location=l.find("[name=location]").val();aH.latitude=l.find("[name=latitude]").val();aH.longitude=l.find("[name=longitude]").val();aH.color=l.find("[name=form_color]").val();aH.tooltip_title=l.find("[name=tooltip_title]").val();aH.tooltip_text=l.find("[name=tooltip_text]").val();aH.click_action_value=l.find("[name=click_action]").val();return aH};var aw=function(aH){if(aH.hasClass("table_edit")||aH.hasClass("table_add")){return false}return true};var n=function(){if(P.find("tbody tr").length==0){P.find("tfoot").show()}};var ab=function(aJ,aI,aH){if(aH){if(!aw(aI)){return}}aJ.remove();n();U()};var N=function(){var aH=[];P.find("tbody tr").each(function(){aH.push(jQuery(this).data("value"))});return aH.reverse()};var aA=function(aL){if(jQuery(aL.target).closest("td").hasClass("delete_cell")){ab(jQuery(this),jQuery("#new_maps_page"),true);return false}var aK=jQuery(this).data("value");B(aK.location,aK.latitude,aK.longitude,aK.color,aK.tooltip_title,aK.tooltip_text,aK.click_action_value);var aJ=af(l,jQuery(this));var aH=jQuery(this).offset().top-jQuery(this).offsetParent().offset().top-aJ;I.css("top",aH);var aI=P.data("selected");if(aI!==null){aI.removeClass("selected_row")}jQuery(this).addClass("selected_row");P.data("selected",jQuery(this));if(typeof setTimeout=="function"){setTimeout(function(){jQuery("#new_maps_page").removeClass("table_add").addClass("table_edit")},10)}else{jQuery("#new_maps_page").removeClass("table_add").addClass("table_edit")}aL.preventDefault();return false};var ad=function(){return al.find(":selected").val()};var aj=function(){var aH=ad();return jQuery("#data_of_click_action_"+aH).find(".description").html()};var aq=function(){var aH=ad();return jQuery("#data_of_click_action_"+aH).find(".example").html()};var W=function(aK,aH,aM){var aL=at[0].contentWindow;var aJ=new aL.google.visualization.GeoChart(document.getElementById("invisible_container"));var aI=jQuery.extend(true,{},aL.map_generator.maps[1]["options"]);aI.height=aH;aI.width=aK;aJ.draw(aL.gtables[1],aI);aL.google.visualization.events.addListener(aJ,"ready",function(){aM(aJ.getImageURI())})};var q=function(aI){var aJ=/rgb\((\d+).*?(\d+).*?(\d+)\)/.exec(aI);var aH=parseInt(aJ[1]);var aK=parseInt(aJ[2]);var aN=parseInt(aJ[3]);var aP={r:aH,g:aK,b:aN};var aO=r(aP);var aM=(aH+aK+aN)/3;var aL=Math.sqrt(Math.pow(aO.value,2)+Math.pow(aO.saturation*(aO.value/100),2));if(aL>30+aO.saturation){return"rgb("+10+","+10+","+10+")"}else{return"rgb("+230+","+230+","+230+")"}};var r=function(aJ){var aI=new Object();var aH=h(aJ.r,aJ.g,aJ.b);var aK=aH-F(aJ.r,aJ.g,aJ.b);aI.saturation=(aH==0)?0:(100*aK/aH);if(aI.saturation==0){aI.hue=0}else{if(aJ.r==aH){aI.hue=60*(aJ.g-aJ.b)/aK}else{if(aJ.g==aH){aI.hue=120+60*(aJ.b-aJ.r)/aK}else{if(aJ.b==aH){aI.hue=240+60*(aJ.r-aJ.g)/aK}}}}if(aI.hue<0){aI.hue+=360}aI.value=Math.round(aH*100/255);aI.hue=Math.round(aI.hue);aI.saturation=Math.round(aI.saturation);return aI};var F=function(aI,aH,aJ){return(aI<aH)?((aI<aJ)?aI:aJ):((aH<aJ)?aH:aJ)};var h=function(aI,aH,aJ){return(aI>aH)?((aI>aJ)?aI:aJ):((aH>aJ)?aH:aJ)};var L=function(aI){var aK=parseInt((o(aI)).substring(0,2),16),aJ=parseInt((o(aI)).substring(2,4),16),aH=parseInt((o(aI)).substring(4,6),16);return"rgb("+aK+","+aJ+","+aH+")"};var o=function(aH){return(aH.charAt(0)=="#")?aH.substring(1,7):aH};P.data("selected",null);if(data_table!==null&&typeof data_table=="object"){a.each(data_table,function(aH,aI){var aJ=j(aI.location,aI.latitude,aI.longitude,aI.color,aI.tooltip_title,aI.tooltip_text,aI.click_action_value);aJ.data("value",aI);aJ.bind("click tap",aA);c.prepend(aJ);P.find("tfoot").hide()})}else{data_table=[]}a.each(av,function(aI,aJ){var aN=ag;var aL=p;var aH=aJ[0];var aR=aJ[1];var aO=aJ[2];var aK=aJ[3];var aM=jQuery(aH);var aQ=aM.attr("type");if(aQ=="checkbox"){aM.prop("checked",aL.get(default_options,aR)=="true")}else{var aP=aL.get(default_options,aR);aM.val(aP);if(aO=="color"){aM.val(aP.toLowerCase());aM.css("color",q(L(aP))).css("background",aP)}}});jQuery(".add_to_table").bind("click",function(aJ){var aI=af(l,P.find("thead tr"));var aH=P.data("selected");if(aH!==null){aH.removeClass("selected_row")}P.data("selected",null);if(typeof setTimeout=="function"){setTimeout(function(){jQuery("#new_maps_page").removeClass("table_edit").addClass("table_add")},10)}else{jQuery("#new_maps_page").removeClass("table_edit").addClass("table_add")}return false});jQuery("#data_table_form_delete").bind("click tap",function(aH){var aI=P.data("selected");if(aI!==null){ab(aI,jQuery("#new_maps_page"),false);jQuery("#new_maps_page").removeClass("table_edit table_add")}aH.preventDefault();return false});jQuery("#data_table_form_change").bind("click tap",function(aI){var aJ=P.data("selected");if(aJ!==null){var aH=A();aD(aJ,aH.location,aH.latitude,aH.longitude,aH.color,aH.tooltip_title,aH.tooltip_text,aH.click_action_value);aJ.data("value",aH);console.log(aJ.data("value"));aJ.removeClass("selected_row");jQuery("#new_maps_page").removeClass("table_edit table_add");U()}aI.preventDefault();return false});jQuery("#data_table_form_cancel").bind("click tap",function(aI){var aH=P.data("selected");if(aH!==null){aH.removeClass("selected_row")}jQuery("#new_maps_page").removeClass("table_edit table_add");aI.preventDefault();return false});jQuery("#data_table_form_add").bind("click tap",function(aI){var aH=A();var aJ=j(aH.location,aH.latitude,aH.longitude,aH.color,aH.tooltip_title,aH.tooltip_text,aH.click_action_value);aJ.data("value",aH);aJ.bind("click tap",aA);c.prepend(aJ);P.find("tfoot").hide();jQuery("#new_maps_page").removeClass("table_edit table_add");U();aI.preventDefault()});jQuery("#title").focusin(function(){jQuery("#title-prompt-text").hide()});jQuery("#title").focusout(function(){if(jQuery("#title").val()==""){jQuery("#title-prompt-text").show()}});if(jQuery("#title").val()!==""){jQuery("#title-prompt-text").hide()}jQuery(".map_transaction").bind("click tap",function(aH){var aJ=this;jQuery(this).siblings(".spinner").css("visibility","visible");set_message("");var aI=function(aK){var aL=aJ;jQuery.ajax({dataType:"json",url:imb_object.ajax_url,type:"POST",data:{action:"imb_save_map",id:map_id,title:jQuery("#title").val(),click_action:ad(),mode:current_mode,table:N(),image:aK,options:p.get_all(default_options)},success:function(aM){jQuery(aL).siblings(".spinner").css("visibility","hidden");if(aM!==null&&typeof aM=="object"){if(typeof aM.message!=="undefined"){set_message(aM.message)}else{if(typeof aM.error!=="undefined"){set_error_message(aM.error)}}}console.log(aM)}})};W(300,150,aI);jQuery(this).blur();aH.preventDefault()});jQuery("#find_coordinates_link").click(function(aH){jQuery("#data_form_location").css("borderColor","");jQuery(".data_table_form .rm_box").addClass("visible");jQuery("#data_form_location").focus().select();aH.preventDefault()});jQuery("#data_table_lat_long_close").click(function(aH){jQuery(".data_table_form .rm_box").removeClass("visible");aH.preventDefault()});jQuery("#data_table_lat_long_search").click(function(aI){aI.preventDefault();var aH=jQuery("#data_form_location").val();jQuery("#lat_long_spinner").show();jQuery.ajax({type:"GET",dataType:"json",url:"http://maps.googleapis.com/maps/api/geocode/json",data:{address:aH,sensor:false},success:function(aJ){if(aJ.results.length){jQuery("#data_form_latitude").val(aJ.results[0].geometry.location.lat);jQuery("#data_form_longitude").val(aJ.results[0].geometry.location.lng);jQuery("#lat_long_spinner").hide();jQuery(".data_table_form .rm_box").removeClass("visible")}else{jQuery("#data_form_location").css("borderColor","#D54E21");jQuery("#lat_long_spinner").hide()}}})});jQuery("#data_form_location").keypress(function(aH){if(aH.which==13){jQuery("#data_table_lat_long_search").trigger("click")}jQuery("#data_form_location").css("borderColor","")});ak.addListener("change",function(){var aI=ak.get_value();var aH=ak.find_resolutions(aI);k.set_available_resolutions(aH);default_options.region=aI;default_options.resolution=k.get_value();ag()});v.addListener("change",function(){var aH=v.get_value();if(aH=="regions"){jQuery("#new_maps_page").removeClass("marker_text_mode marker_coord_mode").addClass("region_mode");current_mode="regions";default_options.displayMode="regions"}else{if(aH=="text"){jQuery("#new_maps_page").removeClass("region_mode marker_coord_mode").addClass("marker_text_mode");current_mode="marker_by_name";default_options.displayMode="markers"}else{if(aH=="coordinates"){jQuery("#new_maps_page").removeClass("marker_text_mode region_mode").addClass("marker_coord_mode");current_mode="marker_by_coordinates";default_options.displayMode="markers"}}}U()});k.addListener("change",function(){var aH=k.get_value();default_options.resolution=aH;ag()});a.each(av,function(aK,aJ){var aM=ag;var aI=p;var aH=aJ[0];var aO=aJ[1];var aL=aJ[2];var aN=aJ[3];jQuery(aH).change(function(){var aR=jQuery(this);var aP=aR.val();var aQ=aR.attr("type");if(aQ=="checkbox"){if(aR.is(":checked")){aP="true"}else{aP="false"}}if(aP==""){if(aN===null){aR.val(aI.get(default_options,aO))}else{aR.val(aN);var aS=aI.get(default_options,aO);if(aS!=aN){aI.set(default_options,aO,aN);aM()}}return}if(aL=="number"){if(!/^\d+$/.test(aP)&&aP!=aN){aR.css("borderColor","#D54E21");return}aR.css("borderColor","")}else{if(aL=="color"){aP=aP.toLowerCase();if(!/^#[a-f0-9]{6}$/i.test(aP)){aR.css("borderColor","#D54E21");return}aR.css("borderColor","")}else{if(aL=="percent"){if(!/^\d+$/.test(aP)){aR.css("borderColor","#D54E21");return}if(parseInt(aP)<0||100<parseInt(aP)){aR.css("borderColor","#D54E21");return}aR.css("borderColor","")}}}var aS=aI.get(default_options,aO);if(aS!=aP){console.log(aS,aP);aI.set(default_options,aO,aP);aM()}})});al.change(function(){var aI=ad();Q.load(aI);at=Q.get_iframe();if(aI!=-1){var aH=aj();if(aH!=""){aE.html(aH);jQuery("#li_description").removeClass("empty_description")}else{jQuery("#li_description").addClass("empty_description")}jQuery("#li_description").removeClass("hide_me");jQuery("#example_box").removeClass("hide_me")}else{jQuery("#li_description").addClass("hide_me");jQuery("#example_box").addClass("hide_me")}an.html(aq())});jQuery("#map_click_control .value").click(function(aI){var aH=jQuery(this).attr("what");if(aH=="open_dialog"){page_config.map_click_opens_dialog=!page_config.map_click_opens_dialog}else{if(aH=="click_action"){page_config.map_click_runs_action=!page_config.map_click_runs_action}}});var e=jQuery(".aaacolorpicker");e.each(function(){var aJ=jQuery(this);var aK=aJ.parents(".colorpicker_parent");var aH=L;var aI=q;aJ.removeClass("picker_is_open");aJ.iris({change:function(aN,aO){var aM=jQuery(this);var aL=aO.color.toString();aM.val(aL).css("background",aL);aM.css("color",aI(aH(aL)))},palettes:["#125","#459","#78b","#ab0","#de3","#f0f"],mode:"hsv",controls:{horiz:"h",vert:"v",strip:"s"}});aJ.on("mousedown",function(aL){if(aJ.hasClass("picker_is_open")){jQuery(this).iris("hide");aJ.removeClass("picker_is_open")}else{jQuery(this).iris("show");aJ.addClass("picker_is_open")}aJ.trigger("change")})});jQuery(".wrap").on("mousedown",function(aJ){var aI=jQuery(aJ.target).parents(".colorpicker_parent").find(".aaacolorpicker");var aH=e.filter(".picker_is_open");aH.not(aI).removeClass("picker_is_open").trigger("change").iris("hide")})}else{if(jQuery("#click_actions_page").length!=0){var w=imb_object.click_action_page_url;var t=new Menu_Handler(".elements","#name_input_container",w);var Q=new Preview_Handler(imb_object.iframe_url,"#action_preview",".loader");var aC=new Import_Box("#import_box","#import_action");var Y=new Click_Action_Page(page_config.base_mode,page_config.base_action,page_config.click_actions,Q,null,aC,w);var ap=document.getElementById("html_textarea");var s=document.getElementById("js_textarea");var X=document.getElementById("css_textarea");var ax=jQuery(".elements");var b="highlighted arrow_right";var M="linked";var S=function(){jQuery(ap).val(E.getValue());jQuery(s).val(ar.getValue());jQuery(X).val(z.getValue())};var A=function(){var aH=Y.form.get_data();if(Y.current_mode=="edit"||Y.current_mode=="copy"){aH.name=jQuery("#loading_content .highlighted input").val()}else{aH.name=jQuery("#name_input_container input").val()}return aH};var i=function(aH,aK){var aJ=jQuery("#loading_content");aJ.find(">").remove();aJ.html(aH);t.bind_events();t.highlight(aK);var aI=aJ.find(".element").length;jQuery("#action_count").text(aI)};var ai=function(){var aI=jQuery("#loading_content .highlighted").prevAll(".linked:first");if(aI.length==1){return aI.find("[actionid]").attr("actionid")}var aH=jQuery("#loading_content .highlighted").nextAll(".linked:first");if(aH.length==1){return aH.find("[actionid]").attr("actionid")}return null};var J=function(){var aJ=ai();Y.hide_message();if(Y.current_mode!=="copy"){S()}Y.show_button_spinner();var aI=Y;var aH=i;jQuery.ajax({url:ajaxurl,data:{action:"imb_save_clickaction",mode:Y.current_mode,form:A(),import_data:jQuery("#import_text").val()},dataType:"json",type:"POST",success:function(aL,aM,aK){aI.hide_button_spinner();if(typeof aL=="undefined"||typeof aL.success=="undefined"||typeof aL.message=="undefined"){aI.show_message("",".error_incomplete","error");return}if(aL.success){aH(aL.menu,aL.id);aI.show_message(aL.message,".success","updated");aI.actions=aL.click_actions;aI.current_action=-3;aI.current_mode="edit";if(aL.id==-2){if(aJ&&typeof aI.actions[aJ]!=="undefined"){aI.change_page(aJ,"show",true)}else{aI.change_page(-1,"show",true)}}else{aI.change_page(aL.id,"show",true)}}else{aI.show_message(aL.message,".error_custom","error")}},error:function(aK,aM,aL){aI.hide_button_spinner();aI.change_page(aI.current_action,"show",true);switch(aM){case"timeout":aI.show_message("",".error_timeout","error");break;case"error":aI.show_message("",".error_error","error");break;case"abort":aI.show_message("",".error_abort","error");break;case"parsererror":aI.show_message("",".error_parsererror","error");break;default:aI.show_message("",".success","error");break}},timeout:15000})};CodeMirror.defineMode("mustache",function(aH,aI){var aJ={token:function(aM,aL){var aK;if(aM.match("{{")){while((aK=aM.next())!=null){if(aK=="}"&&aM.next()=="}"){break}}aM.eat("}");return"mustache"}while(aM.next()!=null&&!aM.match("{{",false)){}return null}};return CodeMirror.overlayMode(CodeMirror.getMode(aH,aI.backdrop||"htmlmixed"),aJ)});var E=CodeMirror.fromTextArea(ap,{lineNumbers:true,mode:"mustache",autoCloseTags:true,matchTags:{bothTags:true},styleActiveLine:true,extraKeys:{F11:function(aH){aH.setOption("fullScreen",!aH.getOption("fullScreen"))},Esc:function(aH){if(aH.getOption("fullScreen")){aH.setOption("fullScreen",false)}}}});var ar=CodeMirror.fromTextArea(s,{lineNumbers:true,mode:"javascript",styleActiveLine:true,extraKeys:{F11:function(aH){aH.setOption("fullScreen",!aH.getOption("fullScreen"))},Esc:function(aH){if(aH.getOption("fullScreen")){aH.setOption("fullScreen",false)}}}});var z=CodeMirror.fromTextArea(X,{lineNumbers:true,mode:"css",styleActiveLine:true,extraKeys:{F11:function(aH){aH.setOption("fullScreen",!aH.getOption("fullScreen"))},Esc:function(aH){if(aH.getOption("fullScreen")){aH.setOption("fullScreen",false)}}}});t.addListener("click",function(){Y.change_page(t.clicked_id,"show",true)});t.addListener("dblclick",function(){Y.change_page(t.clicked_id,"edit",true)});Y.addListener("action_change",function(){if(Y.current_mode=="show"){t.highlight(Y.current_action)}else{if(Y.current_mode=="new"){t.dehighlight()}else{if(Y.current_mode=="edit"){}}}});jQuery(".left_container .actions .input_element input").focusin(function(){jQuery(".left_container .actions .input_element label").hide()});jQuery(".left_container .actions .input_element input").focusout(function(){if(jQuery(".left_container .actions .input_element input").val()==""){jQuery(".left_container .actions .input_element label").show()}});if(jQuery(".left_container .actions .input_element input").val()!==""){jQuery(".left_container .actions .input_element label").hide()}a(".form_submit").click(function(){Q.show_loader();Y.form.$form.attr("action",Q.url+Y.current_action);a("html, body").animate({scrollTop:0},600)});a("#add_action, #create_first").click(function(aH){Y.change_page(-1,"new",true);Y.fadeout_message();aH.preventDefault()});a("#add_button").click(function(aH){J();aH.preventDefault()});a("#export_link").click(function(aH){Y.change_page(Y.current_action,"export",true);Y.fadeout_message();aH.preventDefault()});a("html").keyup(function(aH){if(aH.keyCode==46&&Y.current_mode=="show"){jQuery("#delete_action_name").html(Y.actions[Y.current_action]["name_esc"]);Y.change_page(Y.current_action,"delete",true);aH.preventDefault()}});a("#edit_button").click(function(aH){J();aH.preventDefault()});jQuery("#delete_link").click(function(aH){jQuery("#delete_action_name").html(Y.actions[Y.current_action]["name_esc"]);Y.change_page(Y.current_action,"delete",true);aH.preventDefault()});jQuery("#delete_confirm_button").click(function(aH){J();Y.change_page(Y.current_action,"show",false);aH.preventDefault()});jQuery("label.layover").siblings("input, textarea").focusout(function(){if(jQuery(this).val()==""){jQuery(this).siblings("label").show()}}).focusin(function(){jQuery(this).siblings("label").hide()}).each(function(){if(jQuery(this).val()==""){jQuery(this).siblings("label").show()}else{jQuery(this).siblings("label").hide()}});jQuery("#copy_link").click(function(aH){Y.current_mode="copy";Y.set_form_elements(Y.current_action,"copy");J();aH.preventDefault()});jQuery("#import_confirm_button").click(function(aH){Y.current_mode="import";J();Y.change_page(Y.current_action,"show",true);aH.preventDefault()});jQuery("#edit_link").click(function(aH){aH.preventDefault();Y.change_page(Y.current_action,"edit",true)});jQuery(".messagebg, .messagebox .close").click(function(){Y.change_page(Y.current_action,"show",true)});window.addEventListener("popstate",function(aI){var aH=aI.state;if(aH){if(typeof Y.actions[aH.action]!=="undefined"||aH.action==Y.current_action){Y.change_page(aH.action,aH.mode,false)}}else{Y.change_page(page_config.base_action,page_config.base_mode,false)}console.log(aH)});var ae=jQuery("[name=data_table_value_1]");var ac=jQuery("[name=data_table_value_2]");var aa=jQuery("[name=data_table_value_3]");var x=jQuery("#description");ae.css("height","20px");ac.css("height","20px");aa.css("height","20px");x.css({height:"20px",padding:"1em"});ae.autosize();ac.autosize();aa.autosize();ae.css("height","20px");ac.css("height","20px");aa.css("height","20px");x.autosize();jQuery(".show_table").click(function(){var aI=jQuery(this).attr("toggle");var aH=jQuery(this).text();jQuery(this).attr("toggle",aH);jQuery(this).text(aI);jQuery(".table_container").slideToggle();if(ae.is(":visible")){ae.trigger("autosize.resize");ac.trigger("autosize.resize");aa.trigger("autosize.resize")}});Y.addListener("change",function(){if(Y.current_mode=="edit"||Y.current_mode=="new"){if(ae.is(":visible")){ae.trigger("autosize.resize");ac.trigger("autosize.resize");aa.trigger("autosize.resize")}if(!jQuery(".table_container").is(":visible")){jQuery(".show_table").trigger("click")}E.setValue(jQuery(ap).val());E.refresh();ar.setValue(jQuery(s).val());ar.refresh();z.setValue(jQuery(X).val());z.refresh();x.trigger("autosize.resize")}receive_map_event()})}else{if(jQuery("#manage_maps_page").length!=0){var Y=jQuery("#manage_maps_page");var G=jQuery("#delete_box");var am=jQuery("#import_box");var ah=jQuery("#export_box");Y.data("wait_for_load",false);var f=function(){jQuery(".description_container small").fitText()};var aB=function(aI){var aH="delete_mode import_mode export_mode";if(aI=="delete"){Y.removeClass(aH).addClass("delete_mode")}else{if(aI=="import"){Y.removeClass(aH).addClass("import_mode")}else{if(aI=="export"){Y.removeClass(aH).addClass("export_mode")}else{Y.removeClass(aH)}}}};var ay=function(aJ){var aI=jQuery(this).parents("tr");var aK=aI.attr("mapid");var aH=aI.attr("mapname");G.find("#delete_action_name").text(aH);G.find("#delete_confirm_button").attr("href",page_config.delete_url+aK);G.data("selected_id",aK);R();aB("delete");aJ.stopImmediatePropagation();aJ.preventDefault()};var O=function(aJ){var aI=jQuery(this).parents("tr");var aK=aI.attr("mapid");var aH=aI.attr("mapname");jQuery("#export_text").val(aI.find(".export_data textarea").val());ah.find(".download_map").attr("href",page_config.download_url+aK);aB("export");R();aJ.stopImmediatePropagation();aJ.preventDefault()};var d=function(){jQuery("#table_spinner").css({opacity:0.9,display:"block"})};var az=function(){jQuery("#table_spinner").css({opacity:0,display:"block"})};var D=function(){jQuery(".manage_maps_table").css({opacity:0.5})};var K=function(){jQuery(".manage_maps_table").css({opacity:1})};var au=function(aH,aJ,aL){var aI=y;var aK=Y;if(!aJ&&aL){jQuery("#loading_area").html(aL);aI();return}jQuery("#loading_area").load(aH+" #loading_area >",function(){if(aJ&&page_config.enable_history){page_config.first_pop=false;history.pushState({url:aH,data:jQuery("#loading_area").html()},"",aH)}jQuery(".manage_maps_table").css({opacity:1});if(Y.data("wait_for_load")){var aM=jQuery("#message");aM.css("visibility","visible");aM.slideDown();Y.data("wait_for_load",false)}var aN=Y.data("newid");jQuery("[mapid="+aN+"]").find(".newflag").show();aI()})};var H=function(aH){aH.preventDefault();D();d();au(jQuery(this).attr("href"),true);jQuery(this).blur()};var Z=function(aI,aJ){var aH=jQuery("#message");aH.removeClass("updated error");aH.find("p").hide();switch(aI){case"custom_success":aH.addClass("updated");aH.find(".custom_success").text(aJ).show();break;case"success_delete":aH.addClass("updated");aH.find(".success_delete").show();break;case"success_copy":aH.addClass("updated");aH.find(".success_copy").show();break;case"error_delete":aH.addClass("error");aH.find(".error_delete").show();break;case"error_copy":aH.addClass("error");aH.find(".error_copy").show();break;case"custom_error":aH.addClass("error");aH.find(".custom_error").text(aJ).show();break;case"timeout":aH.addClass("error");aH.find(".error_timeout").show();break;case"error":aH.addClass("error");aH.find(".error_error").show();break;case"abort":aH.addClass("error");aH.find(".error_abort").show();break;case"parsererror":aH.addClass("error");aH.find(".error_parsererror").show();break;case"error_incomplete":aH.addClass("error");aH.find(".error_incomplete").show();break;default:break}if(!Y.data("wait_for_load")){aH.css("visibility","visible");aH.slideDown()}};var ao=function(aK){var aL=jQuery(this).parents("tr").attr("mapid");D();d();aB("");jQuery("#message").css("visibility","hidden");var aI=az;var aJ=K;var aH=Y;jQuery.ajax({url:ajaxurl,data:{action:"imb_copy_map",id:aL},dataType:"json",success:function(aN,aO,aM){if(typeof aN.success=="undefined"||typeof aN.message=="undefined"||typeof aN.newid=="undefined"){Z("error_incomplete");aI();aJ();return}if(aN.success){aH.data("wait_for_load",true);aH.data("newid",aN.newid);if(aN.message==""){Z("success_copy")}else{Z("custom_success",aN.message)}au(jQuery(".manage_maps_table").attr("baseurl"),true)}else{if(aN.message==""){Z("error_copy")}else{Z("custom_error",aN.message)}aI();aJ()}console.log("success",aN)},error:function(aM,aO,aN){aI();aJ();switch(aO){case"timeout":Z("timeout");break;case"error":Z("error");break;case"abort":Z("abort");break;case"parsererror":Z("parsererror");break;default:Z("error");break}},timeout:15000});aK.preventDefault()};var T=function(aK){var aL=G.data("selected_id");D();d();aB("");jQuery("#message").css("visibility","hidden");var aI=az;var aJ=K;var aH=Y;jQuery.ajax({url:ajaxurl,data:{action:"imb_delete_map",id:aL},dataType:"json",success:function(aN,aO,aM){if(typeof aN.success=="undefined"||typeof aN.message=="undefined"){Z("error_incomplete");aI();aJ();return}if(aN.success){aH.data("wait_for_load",true);if(aN.message==""){Z("success_delete")}else{Z("custom_success",aN.message)}au(jQuery(".manage_maps_table").attr("thisurl"),true)}else{if(aN.message==""){Z("error_delete")}else{Z("custom_error",aN.message)}aI();aJ()}console.log("success",aN)},error:function(aM,aO,aN){aI();aJ();switch(aO){case"timeout":Z("timeout");break;case"error":Z("error");break;case"abort":Z("abort");break;case"parsererror":Z("parsererror");break;default:Z("error");break}},timeout:15000});aK.preventDefault()};var V=function(aH){if(jQuery(this).hasClass("preview_normal")){jQuery("#loading_area").removeClass().addClass("midsize_preview")}else{if(jQuery(this).hasClass("preview_small")){jQuery("#loading_area").removeClass()}else{if(jQuery(this).hasClass("preview_big")){jQuery("#loading_area").removeClass().addClass("bigsize_preview")}}}f();aH.preventDefault()};var g=function(aJ){console.log(jQuery(this));var aI=jQuery(this).parents("tr");aI.find("td:first-child,td:nth-child(2)").unbind("click tap");var aH=aI.find(".map_link").attr("href");aI.addClass("selected");window.location=aH;aJ.preventDefault()};var y=function(){jQuery(".maps_pagination00 a").bind("click tap",H);jQuery(".delete_link").bind("click tap",ay);jQuery(".export_link").bind("click tap",O);jQuery(".copy_link").bind("click tap",ao);jQuery(".manage_maps_table th a").bind("click tap",H);jQuery(".preview_sizes").bind("click tap",V);m();f()};a.ajaxSetup({cache:true});jQuery(".keep_width").each(function(){console.log(this);jQuery(this).css("width",jQuery(this).width())});Y.find(".close, .messagebg").bind("tap click",function(aH){aB("");aH.preventDefault()});jQuery("#import_link").bind("click tap",function(aH){aB("import");aH.preventDefault()});jQuery("#delete_confirm_button").bind("click",T);am.find(".tab_list li").bind("click tap",function(aJ){var aI=jQuery(this);aJ.preventDefault();if(aI.hasClass("selected_tab")){return}var aH=aI.attr("setclass");am.find(".tab_inner").removeClass().addClass("tab_inner").addClass(aH);am.find(".selected_tab").removeClass("selected_tab");aI.addClass("selected_tab")});am.find("textarea").focusin(function(){jQuery(this).siblings("label").hide()}).focusout(function(){if(jQuery(this).val()==""){jQuery(this).siblings("label").show()}});if(am.find("textarea").val()!==""){am.find("textarea").siblings("label").hide()}ah.find(".tab_list li").click(function(aJ){var aI=jQuery(this);aJ.preventDefault();if(aI.hasClass("selected_tab")){return}var aH=aI.attr("setclass");ah.find(".tab_inner").removeClass().addClass("tab_inner").addClass(aH);ah.find(".selected_tab").removeClass("selected_tab");aI.addClass("selected_tab")});jQuery(window).resize(aG(f,200,false));y();if(page_config.enable_history){window.addEventListener("popstate",function(aI){if(page_config.first_pop){page_config.first_pop=false;return}var aH=aI.state;if(aH){D();d();au(aH.url,false,aH.data)}else{console.log(aI);D();d();au(page_config.base_url,false)}})}}}}})}(jQuery));function EventTarget(){this._listeners={}}EventTarget.prototype={constructor:EventTarget,addListener:function(a,b){if(typeof this._listeners[a]=="undefined"){this._listeners[a]=[]}this._listeners[a].push(b)},fire:function(d){if(typeof d=="string"){d={type:d}}if(!d.target){d.target=this}if(!d.type){throw new Error("Event object missing 'type' property.")}if(this._listeners[d.type] instanceof Array){var c=this._listeners[d.type];for(var b=0,a=c.length;b<a;b++){c[b].call(this,d)}}},removeListener:function(d,e){if(this._listeners[d] instanceof Array){var c=this._listeners[d];for(var b=0,a=c.length;b<a;b++){if(c[b]===e){c.splice(b,1);break}}}}};